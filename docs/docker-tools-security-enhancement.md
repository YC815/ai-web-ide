# Docker å·¥å…·å®‰å…¨å¼·åŒ–å ±å‘Š

## ğŸ”’ å®‰å…¨å¼·åŒ–æ¦‚è¿°

ç‚ºäº†ç¢ºä¿ AI å·¥å…·**çµ•å°åªåœ¨ Docker å®¹å™¨å…§éƒ¨**æ“ä½œï¼Œé¿å…ä¿®æ”¹å®¿ä¸»æ©Ÿæª”æ¡ˆï¼Œæˆ‘å€‘å°ä»¥ä¸‹æ ¸å¿ƒå·¥å…·é€²è¡Œäº†å…¨é¢çš„å®‰å…¨å¼·åŒ–ï¼š

- `detect_project_path` - å°ˆæ¡ˆè·¯å¾‘æª¢æ¸¬å·¥å…·
- `intelligent_file_search` - æ™ºèƒ½æª”æ¡ˆæœå°‹å·¥å…·
- `read_file` - æª”æ¡ˆè®€å–å·¥å…·
- `create_file` - æª”æ¡ˆå‰µå»ºå·¥å…·

## ğŸ›¡ï¸ å®‰å…¨æªæ–½

### 1. Docker ä¸Šä¸‹æ–‡é©—è­‰

æ‰€æœ‰å·¥å…·ç¾åœ¨éƒ½æœƒé¦–å…ˆé©—è­‰ Docker ä¸Šä¸‹æ–‡ï¼š

```typescript
// 1. é¦–å…ˆé©—è­‰ Docker ä¸Šä¸‹æ–‡
const dockerValidation = this.securityValidator.validateDockerContext(
  dockerContext,
  normalizedProjectName
);
if (!dockerValidation.isValid) {
  return `âŒ Docker å®‰å…¨é©—è­‰å¤±æ•—: ${dockerValidation.reason}`;
}
```

### 2. è·¯å¾‘å®‰å…¨é©—è­‰

å¢å¼·çš„è·¯å¾‘é©—è­‰ç¢ºä¿åªèƒ½æ“ä½œå°ˆæ¡ˆå·¥ä½œå€å…§çš„æª”æ¡ˆï¼š

```typescript
// 3. é©—è­‰æª”æ¡ˆè·¯å¾‘å®‰å…¨æ€§
const pathValidation = this.securityValidator.validateFilePath(
  path,
  dockerContext,
  normalizedProjectName
);
if (!pathValidation.isValid) {
  return `âŒ æª”æ¡ˆè·¯å¾‘å®‰å…¨é©—è­‰å¤±æ•—: ${pathValidation.reason}`;
}
```

### 3. åš´æ ¼è·¯å¾‘é™åˆ¶

- âœ… **å…è¨±**ï¼š`/app/workspace/[projectName]/` å…§çš„æ‰€æœ‰è·¯å¾‘
- âŒ **ç¦æ­¢**ï¼šä»»ä½•å®¿ä¸»æ©Ÿè·¯å¾‘
- âŒ **ç¦æ­¢**ï¼šç³»çµ±ç›®éŒ„ (`/etc/`, `/root/`, `/usr/`, ç­‰)
- âŒ **ç¦æ­¢**ï¼šè·¯å¾‘éæ­·æ”»æ“Š (`../`, `~/`, ç­‰)
- âŒ **ç¦æ­¢**ï¼šæ•æ„Ÿæª”æ¡ˆ (`/.env`, `/node_modules/`, ç­‰)

### 4. å‘½ä»¤å®‰å…¨æª¢æŸ¥

Docker å®¹å™¨å…§çš„å‘½ä»¤åŸ·è¡Œå¢åŠ äº†å±éšªæ“ä½œæª¢æ¸¬ï¼š

```typescript
const dangerousPatterns = [
  "rm -rf /",
  "chmod 777",
  "sudo",
  "docker",
  "/etc/passwd",
  // ... æ›´å¤šå±éšªæ¨¡å¼
];
```

## ğŸ” å®‰å…¨é©—è­‰æµç¨‹

æ¯å€‹å·¥å…·çš„åŸ·è¡Œæµç¨‹ï¼š

1. **Docker ä¸Šä¸‹æ–‡é©—è­‰** â†’ ç¢ºèªå®¹å™¨ ID å’Œç‹€æ…‹
2. **è·¯å¾‘å®‰å…¨æª¢æŸ¥** â†’ ç¢ºä¿è·¯å¾‘åœ¨å…è¨±ç¯„åœå…§
3. **å‘½ä»¤å®‰å…¨æƒæ** â†’ æª¢æ¸¬å±éšªæ“ä½œæ¨¡å¼
4. **å®¹å™¨å…§åŸ·è¡Œ** â†’ ä½¿ç”¨ `docker exec` åœ¨å®¹å™¨å…§æ“ä½œ
5. **çµæœé©—è­‰** â†’ è¨˜éŒ„æ“ä½œä¸¦è¿”å›å®‰å…¨çµæœ

## ğŸ“¦ å®¹å™¨è³‡è¨Šé¡¯ç¤º

æ‰€æœ‰å·¥å…·è¼¸å‡ºç¾åœ¨éƒ½æœƒé¡¯ç¤ºå®¹å™¨è³‡è¨Šï¼š

```
âœ… æª”æ¡ˆ src/app/page.tsx åœ¨ Docker å®¹å™¨å…§å‰µå»ºæˆåŠŸ
ğŸ“¦ å®¹å™¨: ai_creator_container
ğŸ“ å…§å®¹é•·åº¦: 256 å­—ç¬¦
ğŸ”’ æœå°‹ç¯„åœï¼šåƒ…é™å°ˆæ¡ˆå·¥ä½œå€å…§
```

## ğŸ§ª æ¸¬è©¦æ–¹æ³•

### 1. åŸºæœ¬åŠŸèƒ½æ¸¬è©¦

```bash
# æ¸¬è©¦æª”æ¡ˆè®€å–ï¼ˆæ‡‰è©²æˆåŠŸï¼‰
curl -X POST http://localhost:3000/api/chat \
  -H "Content-Type: application/json" \
  -d '{"message": "è®€å– package.json æª”æ¡ˆ"}'

# æ¸¬è©¦æª”æ¡ˆå‰µå»ºï¼ˆæ‡‰è©²æˆåŠŸï¼‰
curl -X POST http://localhost:3000/api/chat \
  -H "Content-Type: application/json" \
  -d '{"message": "å‰µå»ºä¸€å€‹æ¸¬è©¦æª”æ¡ˆ test.txtï¼Œå…§å®¹æ˜¯ hello world"}'
```

### 2. å®‰å…¨é™åˆ¶æ¸¬è©¦

```bash
# æ¸¬è©¦è·¯å¾‘éæ­·æ”»æ“Šï¼ˆæ‡‰è©²è¢«é˜»æ­¢ï¼‰
curl -X POST http://localhost:3000/api/chat \
  -H "Content-Type: application/json" \
  -d '{"message": "è®€å– ../../../etc/passwd æª”æ¡ˆ"}'

# æ¸¬è©¦ç³»çµ±æª”æ¡ˆè¨ªå•ï¼ˆæ‡‰è©²è¢«é˜»æ­¢ï¼‰
curl -X POST http://localhost:3000/api/chat \
  -H "Content-Type: application/json" \
  -d '{"message": "è®€å– /etc/hosts æª”æ¡ˆ"}'

# æ¸¬è©¦å®¿ä¸»æ©Ÿè·¯å¾‘è¨ªå•ï¼ˆæ‡‰è©²è¢«é˜»æ­¢ï¼‰
curl -X POST http://localhost:3000/api/chat \
  -H "Content-Type: application/json" \
  -d '{"message": "è®€å– /home/user/documents/secret.txt"}'
```

### 3. é æœŸçµæœ

#### âœ… æˆåŠŸæƒ…æ³

```json
{
  "message": "âœ… æª”æ¡ˆ package.json åœ¨ Docker å®¹å™¨å…§è®€å–æˆåŠŸ\nğŸ“¦ ä¾†æºï¼šDocker å®¹å™¨ ai_creator_container"
}
```

#### âŒ å®‰å…¨é˜»æ­¢æƒ…æ³

```json
{
  "message": "âŒ æª”æ¡ˆè·¯å¾‘å®‰å…¨é©—è­‰å¤±æ•—: ç¦æ­¢è¨ªå•å®¹å™¨å·¥ä½œå€å¤–çš„çµ•å°è·¯å¾‘: /etc/passwdã€‚åƒ…å…è¨± /app/workspace/ å…§çš„è·¯å¾‘"
}
```

## ğŸ“‹ å®‰å…¨æª¢æŸ¥æ¸…å–®

- [x] Docker ä¸Šä¸‹æ–‡é©—è­‰
- [x] è·¯å¾‘å®‰å…¨æª¢æŸ¥
- [x] è·¯å¾‘éæ­·æ”»æ“Šé˜²è­·
- [x] ç³»çµ±æª”æ¡ˆè¨ªå•é˜»æ­¢
- [x] å®¿ä¸»æ©Ÿè·¯å¾‘è¨ªå•é˜»æ­¢
- [x] å±éšªå‘½ä»¤æª¢æ¸¬
- [x] å®¹å™¨å…§å‘½ä»¤åŸ·è¡Œ
- [x] æ“ä½œæ—¥èªŒè¨˜éŒ„
- [x] è¶…æ™‚ä¿è­·
- [x] éŒ¯èª¤è™•ç†

## ğŸ¯ æ•ˆæœ

### ä¹‹å‰

- AI å·¥å…·å¯èƒ½æ“ä½œå®¿ä¸»æ©Ÿæª”æ¡ˆ
- ç¼ºä¹è·¯å¾‘é™åˆ¶
- å®‰å…¨é¢¨éšªè¼ƒé«˜

### ä¹‹å¾Œ

- **çµ•å°åªåœ¨ Docker å®¹å™¨å…§æ“ä½œ**
- åš´æ ¼çš„è·¯å¾‘å’Œæ¬Šé™é™åˆ¶
- å¤šå±¤å®‰å…¨é©—è­‰
- è©³ç´°çš„æ“ä½œè¨˜éŒ„
- æ¸…æ¥šçš„å®¹å™¨è³‡è¨Šé¡¯ç¤º

## ğŸ”§ é…ç½®

å®‰å…¨é©—è­‰å™¨é è¨­ç‚ºåš´æ ¼æ¨¡å¼ï¼Œå¦‚éœ€èª¿æ•´ï¼š

```typescript
// è¨­å®šå°ˆæ¡ˆåç¨±
securityValidator.setProjectName("your_project_name");

// èª¿æ•´åš´æ ¼æ¨¡å¼ï¼ˆå»ºè­°ä¿æŒ trueï¼‰
securityValidator.setStrictMode(true);
```

## ğŸ“ æ³¨æ„äº‹é …

1. **æ‰€æœ‰æª”æ¡ˆæ“ä½œç¾åœ¨éƒ½é™åˆ¶åœ¨ `/app/workspace/[projectName]/` å…§**
2. **ä»»ä½•å˜—è©¦è¨ªå•å®¹å™¨å¤–è·¯å¾‘çš„æ“ä½œéƒ½æœƒè¢«é˜»æ­¢**
3. **å·¥å…·æœƒæä¾›å»ºè­°çš„å®‰å…¨è·¯å¾‘**
4. **æ‰€æœ‰æ“ä½œéƒ½æœƒè¨˜éŒ„åœ¨æ—¥èªŒä¸­ä»¥ä¾›å¯©è¨ˆ**

é€™äº›å¼·åŒ–æªæ–½ç¢ºä¿ AI åŠ©æ‰‹ç„¡æ³•æ„å¤–ä¿®æ”¹å®¿ä¸»æ©Ÿæª”æ¡ˆï¼Œæä¾›äº†å¼·å¤§çš„å®‰å…¨ä¿éšœã€‚
