# Diff å·¥å…·ä½¿ç”¨æŒ‡å—

## æ¦‚è¿°

AI Creator ç³»çµ±ç¾åœ¨åŒ…å«äº†ä¸€å¥—å®Œæ•´çš„ diff å·¥å…·ï¼Œå°ˆé–€ç”¨æ–¼è™•ç†å’Œæ‡‰ç”¨æ¨™æº–çš„ unified diff æ ¼å¼ã€‚é€™äº›å·¥å…·è®“ AI å¯ä»¥æ›´ç²¾ç¢ºåœ°ä¿®æ”¹æª”æ¡ˆï¼Œç‰¹åˆ¥é©åˆè™•ç†è¤‡é›œçš„ç¨‹å¼ç¢¼è®Šæ›´ã€‚

## ğŸ› ï¸ å¯ç”¨å·¥å…·

### 1. `validate_diff` - Diff æ ¼å¼é©—è­‰å·¥å…·

**åŠŸèƒ½**ï¼šé©—è­‰ diff æ ¼å¼æ˜¯å¦æ­£ç¢ºï¼Œä½†ä¸æ‡‰ç”¨ä¿®æ”¹
**åˆ†é¡**ï¼šutility
**ç”¨é€”**ï¼šåœ¨æ‡‰ç”¨ diff ä¹‹å‰æª¢æŸ¥æ ¼å¼æ˜¯å¦æ­£ç¢º

#### åƒæ•¸

- `diffContent` (string, å¿…éœ€): è¦é©—è­‰çš„ diff å…§å®¹

#### è¿”å›å€¼

```typescript
{
  success: boolean;
  data?: {
    message: string;
    details: {
      hunksCount: number;
      oldFile?: string;
      newFile?: string;
      hunks: Array<{
        oldStart: number;
        oldCount: number;
        newStart: number;
        newCount: number;
        linesCount: number;
      }>;
    };
  };
  error?: string;
}
```

### 2. `local_apply_diff` - æœ¬åœ° Diff æ‡‰ç”¨å·¥å…·

**åŠŸèƒ½**ï¼šåœ¨æœ¬åœ°æª”æ¡ˆç³»çµ±ä¸­æ‡‰ç”¨ diff æ ¼å¼çš„æª”æ¡ˆä¿®æ”¹
**åˆ†é¡**ï¼šfilesystem
**ç”¨é€”**ï¼šç›´æ¥ä¿®æ”¹å°ˆæ¡ˆæ ¹ç›®éŒ„ä¸­çš„æª”æ¡ˆ

#### åƒæ•¸

- `filePath` (string, å¿…éœ€): è¦ä¿®æ”¹çš„æª”æ¡ˆè·¯å¾‘ï¼ˆç›¸å°æ–¼å°ˆæ¡ˆæ ¹ç›®éŒ„ï¼‰
- `diffContent` (string, å¿…éœ€): æ¨™æº– unified diff æ ¼å¼çš„å…§å®¹

#### è¿”å›å€¼

```typescript
{
  success: boolean;
  data?: {
    message: string;
    filePath: string;
  };
  error?: string;
}
```

### 3. `docker_apply_diff` - Docker Diff æ‡‰ç”¨å·¥å…·

**åŠŸèƒ½**ï¼šåœ¨ Docker å®¹å™¨ä¸­æ‡‰ç”¨ diff æ ¼å¼çš„æª”æ¡ˆä¿®æ”¹
**åˆ†é¡**ï¼šdocker
**ç”¨é€”**ï¼šä¿®æ”¹ Docker å®¹å™¨å…§çš„æª”æ¡ˆ

#### åƒæ•¸

- `filePath` (string, å¿…éœ€): è¦ä¿®æ”¹çš„æª”æ¡ˆè·¯å¾‘ï¼ˆç›¸å°æ–¼å®¹å™¨å·¥ä½œç›®éŒ„ï¼‰
- `diffContent` (string, å¿…éœ€): æ¨™æº– unified diff æ ¼å¼çš„å…§å®¹

## ğŸ“‹ Diff æ ¼å¼è¦æ±‚

### æ¨™æº– Unified Diff æ ¼å¼

1. **å¿…é ˆåŒ…å« hunk æ¨™è¨˜**ï¼š`@@...@@`
2. **ä½¿ç”¨æ¨™æº–å‰ç¶´**ï¼š
   - `+` è¡¨ç¤ºæ·»åŠ çš„è¡Œ
   - `-` è¡¨ç¤ºåˆªé™¤çš„è¡Œ
   - ` ` (ç©ºæ ¼) è¡¨ç¤ºä¸Šä¸‹æ–‡è¡Œ
3. **æ­£ç¢ºçš„è¡Œè™Ÿæ ¼å¼**ï¼š`@@ -oldStart,oldCount +newStart,newCount @@`

### ç¯„ä¾‹ diff æ ¼å¼

```diff
@@ -1,3 +1,4 @@
 ç¬¬ä¸€è¡Œå…§å®¹
-èˆŠçš„ç¬¬äºŒè¡Œ
+æ–°çš„ç¬¬äºŒè¡Œ
+æ–°å¢çš„ç¬¬ä¸‰è¡Œ
 æœ€å¾Œä¸€è¡Œ
```

### è¤‡é›œç¯„ä¾‹

```diff
@@ -1,5 +1,6 @@
 import React from 'react';
-import { Component } from 'react';
+import { Component, useState } from 'react';

 function MyComponent() {
+  const [count, setCount] = useState(0);
   return (
     <div>
```

## ğŸš€ ä½¿ç”¨ç¤ºä¾‹

### 1. é©—è­‰ diff æ ¼å¼

```typescript
// ä½¿ç”¨ validate_diff å·¥å…·
const diffContent = `@@ -1,2 +1,3 @@
 ç¬¬ä¸€è¡Œ
-ç¬¬äºŒè¡Œ
+ä¿®æ”¹çš„ç¬¬äºŒè¡Œ
+æ–°å¢çš„ç¬¬ä¸‰è¡Œ`;

const result = await validateDiff({
  diffContent: diffContent,
});

if (result.success) {
  console.log("Diff æ ¼å¼æ­£ç¢º");
  console.log("Hunks æ•¸é‡:", result.data.details.hunksCount);
} else {
  console.log("Diff æ ¼å¼éŒ¯èª¤:", result.error);
}
```

### 2. æ‡‰ç”¨æœ¬åœ°æª”æ¡ˆä¿®æ”¹

```typescript
// ä½¿ç”¨ local_apply_diff å·¥å…·
const diffContent = `@@ -1,3 +1,4 @@
 console.log('Hello');
-console.log('World');
+console.log('Beautiful World');
+console.log('Welcome!');
 console.log('End');`;

const result = await localApplyDiff({
  filePath: "src/app.js",
  diffContent: diffContent,
});

if (result.success) {
  console.log("æª”æ¡ˆä¿®æ”¹æˆåŠŸ:", result.data.message);
} else {
  console.log("æª”æ¡ˆä¿®æ”¹å¤±æ•—:", result.error);
}
```

### 3. æ‡‰ç”¨ Docker å®¹å™¨å…§æª”æ¡ˆä¿®æ”¹

```typescript
// ä½¿ç”¨ docker_apply_diff å·¥å…·
const diffContent = `@@ -10,3 +10,4 @@
   "dependencies": {
     "react": "^18.0.0",
-    "next": "^13.0.0"
+    "next": "^14.0.0",
+    "typescript": "^5.0.0"
   }`;

const result = await dockerApplyDiff({
  filePath: "package.json",
  diffContent: diffContent,
});
```

## âš ï¸ æ³¨æ„äº‹é …

### 1. è·¯å¾‘å®‰å…¨

- æœ¬åœ°å·¥å…·æœƒè‡ªå‹•æª¢æŸ¥è·¯å¾‘å®‰å…¨æ€§ï¼Œé˜²æ­¢è·¯å¾‘éæ­·æ”»æ“Š
- ä¸å…è¨±ä½¿ç”¨ `..` ç­‰å±éšªè·¯å¾‘å­—ç¬¦

### 2. æª”æ¡ˆç·¨ç¢¼

- æ‰€æœ‰å·¥å…·å‡è¨­æª”æ¡ˆä½¿ç”¨ UTF-8 ç·¨ç¢¼
- äºŒé€²åˆ¶æª”æ¡ˆä¸å—æ”¯æ´

### 3. ä¸Šä¸‹æ–‡åŒ¹é…

- Diff æ‡‰ç”¨æ™‚æœƒåš´æ ¼æª¢æŸ¥ä¸Šä¸‹æ–‡è¡Œæ˜¯å¦åŒ¹é…
- å¦‚æœä¸Šä¸‹æ–‡ä¸åŒ¹é…ï¼Œæ“ä½œæœƒå¤±æ•—ä¸¦è¿”å›è©³ç´°éŒ¯èª¤ä¿¡æ¯

### 4. åŸå­æ€§æ“ä½œ

- æœ¬åœ°å·¥å…·ä½¿ç”¨åŸå­æ€§å¯«å…¥ï¼Œå¤±æ•—æ™‚ä¸æœƒæå£åŸæª”æ¡ˆ
- Docker å·¥å…·ä½¿ç”¨è‡¨æ™‚æª”æ¡ˆç¢ºä¿æ“ä½œå®‰å…¨

## ğŸ”§ éŒ¯èª¤è™•ç†

### å¸¸è¦‹éŒ¯èª¤é¡å‹

1. **æ ¼å¼éŒ¯èª¤**

   ```
   ç„¡æ•ˆçš„ diff æ ¼å¼ï¼šæœªæ‰¾åˆ°ä»»ä½• diff hunk (@@...@@)
   ```

2. **ä¸Šä¸‹æ–‡ä¸åŒ¹é…**

   ```
   Diff æ‡‰ç”¨å¤±æ•—ï¼šç¬¬ 5 è¡Œä¸Šä¸‹æ–‡ä¸åŒ¹é…
   æœŸæœ›: "console.log('test');"
   å¯¦éš›: "console.log('debug');"
   ```

3. **æª”æ¡ˆä¸å­˜åœ¨**
   ```
   ENOENT: no such file or directory, open 'missing-file.txt'
   ```

### é‡è©¦å»ºè­°

- æª¢æŸ¥ diff æ ¼å¼æ˜¯å¦ç¬¦åˆ unified diff æ¨™æº–
- ç¢ºèªæª”æ¡ˆè·¯å¾‘æ­£ç¢ºä¸”æª”æ¡ˆå­˜åœ¨
- é©—è­‰ä¸Šä¸‹æ–‡è¡Œæ˜¯å¦èˆ‡ç›®æ¨™æª”æ¡ˆå…§å®¹å®Œå…¨åŒ¹é…
- ä½¿ç”¨ `validate_diff` å·¥å…·é å…ˆæª¢æŸ¥æ ¼å¼

## ğŸ“Š å·¥å…·æ•´åˆç‹€æ…‹

âœ… **å·²å®Œæˆçš„åŠŸèƒ½**

- Diff æ ¼å¼è§£æå’Œé©—è­‰
- æœ¬åœ°æª”æ¡ˆç³»çµ±æ”¯æ´
- Docker å®¹å™¨æ”¯æ´
- è©³ç´°éŒ¯èª¤å ±å‘Š
- åŸå­æ€§æ“ä½œ
- è·¯å¾‘å®‰å…¨æª¢æŸ¥

âœ… **æ¸¬è©¦è¦†è“‹**

- æ ¼å¼é©—è­‰æ¸¬è©¦
- æˆåŠŸæ‡‰ç”¨æ¸¬è©¦
- éŒ¯èª¤è™•ç†æ¸¬è©¦
- é‚Šç•Œæƒ…æ³æ¸¬è©¦

âœ… **ç³»çµ±æ•´åˆ**

- å·²æ•´åˆåˆ°çµ±ä¸€å·¥å…·ç³»çµ±
- æ”¯æ´ OpenAI Function Call
- åŒ…å«å®Œæ•´çš„å…ƒæ•¸æ“š
- æ”¯æ´å·¥å…·è¨»å†Šå’Œç™¼ç¾

## ğŸ¯ ä½¿ç”¨å ´æ™¯

### 1. ç²¾ç¢ºçš„ç¨‹å¼ç¢¼ä¿®æ”¹

ç•¶éœ€è¦å°æª”æ¡ˆé€²è¡Œç²¾ç¢ºä¿®æ”¹æ™‚ï¼Œdiff å·¥å…·æ¯”å®Œæ•´æª”æ¡ˆé‡å¯«æ›´å®‰å…¨å’Œé«˜æ•ˆã€‚

### 2. ç‰ˆæœ¬æ§åˆ¶å‹å¥½

ç”Ÿæˆçš„ä¿®æ”¹è¨˜éŒ„èˆ‡ Git diff æ ¼å¼å…¼å®¹ï¼Œä¾¿æ–¼ç‰ˆæœ¬æ§åˆ¶å’Œå¯©æŸ¥ã€‚

### 3. å¤§æª”æ¡ˆéƒ¨åˆ†ä¿®æ”¹

å°æ–¼å¤§å‹æª”æ¡ˆï¼Œåªéœ€è¦å‚³è¼¸å’Œè™•ç†è®Šæ›´éƒ¨åˆ†ï¼Œæé«˜æ•ˆç‡ã€‚

### 4. æ‰¹é‡ä¿®æ”¹

å¯ä»¥åœ¨å–®å€‹ diff ä¸­åŒ…å«å¤šå€‹ä¿®æ”¹é»ï¼Œå¯¦ç¾è¤‡é›œçš„æª”æ¡ˆè®Šæ›´ã€‚

## ğŸ”® æœªä¾†æ“´å±•

- æ”¯æ´æ›´å¤š diff æ ¼å¼ï¼ˆcontext diffã€ed script ç­‰ï¼‰
- æ‰¹é‡ diff æ‡‰ç”¨
- Diff è¡çªè§£æ±º
- äº’å‹•å¼ diff æ‡‰ç”¨
- Diff é è¦½å’Œç¢ºèªæ©Ÿåˆ¶
